(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[660],{463:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orders",function(){return s(3609)}])},3609:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var r=s(4246),a=s(7378),c=s(2696),n=s(6256),i=s(5332),d=s(4895),l=s(886),o=e=>{let{cart:t}=e,{cartId:s,createdAt:a,customerId:o,dineInOrTakeout:u,items:m,orderNumber:h,status:p,tableNumber:x}=t;console.log(o);let b=m.reduce((e,t)=>e+t.price*t.quantity,0),g=(0,c.JU)(n.fs,"checkouts",s),f=async()=>{i.ZP.dismiss();let e=(0,c.JU)(n.fs,"checkouts",s);(0,c.r7)(e,{status:"approved"});let t=(0,c.JU)(n.fs,"users",o);(0,c.r7)(t,{notification:["Checkout Update","Your order has been approved","success",!1]}),i.ZP.success("Approve order: "+s);let r=(0,d.Z)(h),a=localStorage.getItem("cashier");(0,l.Z)(m,r,x,u,h,a)},j=async()=>{if("dine in"===u&&0!==x){let e=(0,c.JU)(n.fs,"tables","table_".concat(x));await (0,c.pl)(e,{tableNumber:x,status:"unoccupied"})}let e=(0,c.JU)(n.fs,"users",o);(0,c.r7)(e,{notification:["Checkout Update","Your order has been rejected","warning",!1]}),i.ZP.dismiss(),i.ZP.error("Reject order: "+s),(0,c.r7)(g,{status:"rejected"}),m.forEach(async e=>{var t;let s=(0,c.JU)(n.fs,"menu",e.menuItemId),r=(null===(t=(await (0,c.QT)(s)).data())||void 0===t?void 0:t.stock)||0;await (0,c.r7)(s,{stock:r+e.quantity})})},N=async()=>{i.ZP.dismiss(),i.ZP.success("Order completed: "+s),await (0,c.r7)(g,{status:"completed"});let e=m.map(async e=>{var t;let s=(0,c.JU)(n.fs,"menu",e.menuItemId),r=(null===(t=(await (0,c.QT)(s)).data())||void 0===t?void 0:t.sold)||0;await (0,c.r7)(s,{sold:r+e.quantity})});await Promise.all(e)},v=async()=>{if("dine in"===u&&0!==x){let e=(0,c.JU)(n.fs,"tables","table_".concat(x));await (0,c.pl)(e,{tableNumber:x,status:"unoccupied"})}let e=(0,c.JU)(n.fs,"users",o);(0,c.r7)(e,{notification:["Checkout Update","Your order has been cancelled","error"]}),i.ZP.dismiss(),i.ZP.error("Order cancelled: "+s),(0,c.r7)(g,{status:"cancelled"}),m.forEach(async e=>{var t,s;let r=(0,c.JU)(n.fs,"menu",e.menuItemId),a=await (0,c.QT)(r);null===(t=a.data())||void 0===t||t.sold;let i=(null===(s=a.data())||void 0===s?void 0:s.stock)||0;await (0,c.r7)(r,{stock:i+e.quantity})})};return(0,r.jsxs)("div",{className:"w-full px-8 py-6 bg-white shadow-md rounded-lg text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between border-b pb-4 mb-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h1",{className:"text-xs font-semibold",children:["Customer ID: ",o]}),(0,r.jsxs)("h2",{className:"text-sm",children:["Order No: ",(0,r.jsx)("strong",{children:h})]}),(0,r.jsxs)("h2",{className:"text-sm",children:["Table No: ",(0,r.jsx)("strong",{children:x})]})]}),(0,r.jsxs)("div",{className:"space-y-2 text-right",children:[(0,r.jsx)("h2",{className:"text-sm capitalize",children:(0,r.jsx)("strong",{children:u})}),(0,r.jsx)("h2",{className:"text-sm lowercase",children:(0,r.jsx)("strong",{children:a.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,r.jsx)("div",{children:m.map((e,t)=>(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("h2",{className:"text-md font-semibold",children:e.name}),(0,r.jsxs)("h2",{className:"text-md",children:[e.quantity,"x"]}),(0,r.jsxs)("h2",{className:"text-md",children:["â‚±",e.price]})]},t))}),(0,r.jsxs)("div",{className:"space-y-2 text-right ",children:[(0,r.jsxs)("h1",{className:"text-base",children:["Total Order: ",(0,r.jsx)("strong",{children:b.toLocaleString("en-US",{style:"currency",currency:"PHP"})})]}),"pending"==p?(0,r.jsxs)("div",{className:"flex space-x-4 mt-4 justify-end",children:[(0,r.jsx)("button",{onClick:f,className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600",children:"Approve"}),(0,r.jsx)("button",{onClick:j,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600",children:"Reject"})]}):(0,r.jsxs)("div",{className:"flex space-x-4 mt-4 justify-end",children:[(0,r.jsx)("button",{onClick:N,className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"Complete"}),(0,r.jsx)("button",{onClick:v,className:"bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600",children:"Cancel"})]})]})]})]})},u=s(3662),m=()=>{let e=(0,u.useRouter)(),[t,s]=(0,a.useState)([]);return(0,a.useEffect)(()=>{let e=()=>{},t=(0,c.hJ)(n.fs,"checkouts"),r=(0,c.IO)(t,(0,c.ar)("status","in",["pending","approved"]),(0,c.Xo)("orderNumber","desc"));return e=(0,c.cf)(r,e=>{e.empty?s([]):s(e.docs.map(e=>{let t=e.data();return{branch:t.branch,cartId:e.id,createdAt:t.createdAt,customerId:t.customerId,dineInOrTakeout:t.dineInOrTakeout,items:t.items,orderNumber:t.orderNumber,status:t.status,tableNumber:t.tableNumber}}))},e=>{console.error("Error fetching cart items: ",e)}),()=>e()},[e]),(0,r.jsx)("div",{className:"py-5 px-40 grid grid-cols-2 gap-3",children:0!=t.length?t.map((e,t)=>(0,r.jsx)(o,{cart:e},t)):(0,r.jsx)("p",{className:"text-3xl font-bold w-full items-center col-span-2",children:"No pending orders"})})}},4895:function(e,t){"use strict";t.Z=e=>{let t=new Date,s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),i=String(t.getSeconds()).padStart(2,"0"),d=String(e).padStart(4,"0");return"TX".concat(s).concat(r).concat(a,"-").concat(c).concat(n).concat(i,"-").concat(d)}},886:function(e,t){"use strict";let s=async(e,t,s,r,a,c)=>{window.ipc.send("print-receipt",{items:e,transactionNumber:t,tableNumber:s,dineInOrTakeout:r,newOrderNumber:a,cashierName:c})};t.Z=s}},function(e){e.O(0,[888,774,179],function(){return e(e.s=463)}),_N_E=e.O()}]);